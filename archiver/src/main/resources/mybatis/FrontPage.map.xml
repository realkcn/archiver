<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.kbs.archiver.persistence.FrontPageMapper">
    <select id="getGroups" resultType="String" useCache="true">
		select groupid from board where ishidden=false Group by groupid
	</select>
    <select id="getHotThreads" resultType="org.kbs.archiver.ThreadEntity" useCache="false">
        select * from newestthread
        <if test="groupid!=null">
            where newestthread.boardid=#{groupid}
        </if>
          order by articlenumber desc limit #{count};
    </select>
    <select id="getNewestThreads" resultType="org.kbs.archiver.ThreadEntity" useCache="false">
        select * from newestthread order by lastposttime desc limit #{count};
    </select>
    <insert id="insertNewestThread" timeout="600" flushCache="false">
        insert into newestthread select thread.*,board.cname as boardname from thread,board
          where thread.boardid=board.boardid and board.ishidden=false and thread.isvisible=true and TIMESTAMPDIFF(HOUR,lastposttime,sysdate()) &lt; #{offsethour}
          ON DUPLICATE KEY UPDATE newestthread.lastposttime=thread.lastposttime,newestthread.lastreply=thread.lastreply,newestthread.articlenumber=thread.articlenumber
    </insert>
    <delete id="deleteOldThread" flushCache="false">
        delete from newestthread where TIMESTAMPDIFF(HOUR,lastposttime,sysdate()) &gt; #{offsethour};
    </delete>
    <delete id="deleteAll" flushCache="false">
        delete from newestthread;
    </delete>
<!-- nocache    <cache /> -->
</mapper>
